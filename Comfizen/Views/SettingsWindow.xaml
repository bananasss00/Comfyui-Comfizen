<Window x:Class="Comfizen.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Comfizen"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        mc:Ignorable="d"
        Title="{local:Translate Settings_Title}" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource PrimaryBackground}"
        Style="{StaticResource CustomWindowStyle}">
    <Window.DataContext>
        <local:SettingsViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <Style TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="{StaticResource TertiaryBackground}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Background="{StaticResource TertiaryBackground}" Padding="5" CornerRadius="3,3,0,0">
                                <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" />
                            </Border>
                            <Border Grid.Row="1" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="0,1,0,0" Padding="{TemplateBinding Padding}" CornerRadius="0,0,3,3">
                                <ContentPresenter/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource SecondaryBackground}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabControl">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TabPanel Grid.Row="0" IsItemsHost="True" Background="{StaticResource TertiaryBackground}"/>
                            <Border Grid.Row="1" Background="{TemplateBinding Background}" BorderThickness="0" CornerRadius="0,0,5,5">
                                <ContentPresenter ContentSource="SelectedContent"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" BorderThickness="0,0,0,2" BorderBrush="Transparent" Margin="0,0,2,0">
                            <ContentPresenter ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PrimaryAccentBrush}"/>
                            </Trigger>
                             <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl>
            <TabItem Header="{local:Translate Settings_Lists}">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <GroupBox Header="{local:Translate Settings_Samplers}" Grid.Column="0">
                        <DockPanel>
                            <Border DockPanel.Dock="Bottom" BorderBrush="{StaticResource TertiaryBackground}" BorderThickness="0,1,0,0" Padding="5" Margin="0,5,0,0">
                                <WrapPanel>
                                    <TextBox Text="{Binding NewSampler, UpdateSourceTrigger=PropertyChanged}" Width="150" Margin="0,0,5,0"/>
                                    <Button Content="{local:Translate Settings_Add}" Command="{Binding AddSamplerCommand}" Margin="0,0,10,0"/>
                                    <Button Content="{local:Translate Settings_Remove}" Command="{Binding RemoveSamplerCommand}" CommandParameter="{Binding ElementName=SamplersListBox}" Background="{StaticResource ErrorBrush}"/>
                                </WrapPanel>
                            </Border>
                            
                            <StackPanel DockPanel.Dock="Right" Margin="5,0,0,0" VerticalAlignment="Center">
                                <Button Content="▲" Command="{Binding MoveSamplerUpCommand}" Margin="0,0,0,5" Padding="5,2" ToolTip="{local:Translate Settings_MoveUp}"/>
                                <Button Content="▼" Command="{Binding MoveSamplerDownCommand}" Padding="5,2" ToolTip="{local:Translate Settings_MoveDown}"/>
                            </StackPanel>
                            
                            <ListBox ItemsSource="{Binding Samplers}" SelectedItem="{Binding SelectedSampler}" 
                                     SelectionMode="Extended" x:Name="SamplersListBox"
                                     Background="{StaticResource SecondaryBackground}" BorderThickness="0"/>
                        </DockPanel>
                    </GroupBox>

                    <GroupBox Header="{local:Translate Settings_Schedulers}" Grid.Column="2">
                        <DockPanel>
                            <Border DockPanel.Dock="Bottom" BorderBrush="{StaticResource TertiaryBackground}" BorderThickness="0,1,0,0" Padding="5" Margin="0,5,0,0">
                                <WrapPanel>
                                    <TextBox Text="{Binding NewScheduler, UpdateSourceTrigger=PropertyChanged}" Width="150" Margin="0,0,5,0"/>
                                    <Button Content="{local:Translate Settings_Add}" Command="{Binding AddSchedulerCommand}" Margin="0,0,10,0"/>
                                    <Button Content="{local:Translate Settings_Remove}" Command="{Binding RemoveSchedulerCommand}" CommandParameter="{Binding ElementName=SchedulersListBox}" Background="{StaticResource ErrorBrush}"/>
                                </WrapPanel>
                            </Border>
                           
                            <StackPanel DockPanel.Dock="Right" Margin="5,0,0,0" VerticalAlignment="Center">
                                <Button Content="▲" Command="{Binding MoveSchedulerUpCommand}" Margin="0,0,0,5" Padding="5,2" ToolTip="{local:Translate Settings_MoveUp}"/>
                                <Button Content="▼" Command="{Binding MoveSchedulerDownCommand}" Padding="5,2" ToolTip="{local:Translate Settings_MoveDown}"/>
                            </StackPanel>

                             <ListBox ItemsSource="{Binding Schedulers}" SelectedItem="{Binding SelectedScheduler}"
                                     SelectionMode="Extended" x:Name="SchedulersListBox"
                                     Background="{StaticResource SecondaryBackground}" BorderThickness="0"/>
                        </DockPanel>
                    </GroupBox>
                </Grid>
            </TabItem>
            
            <TabItem Header="{local:Translate Settings_Main}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                    <StackPanel>
                        <GroupBox Header="{local:Translate Settings_Connection}">
                            <StackPanel>
                                <TextBlock Text="{local:Translate Settings_ServerAddress}" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding ServerAddress}"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="{local:Translate Settings_Paths}">
                            <StackPanel>
                                <TextBlock Text="{local:Translate Settings_ImageSaveDirectory}" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding SavedImagesDirectory}" ToolTip="{local:Translate Settings_ImageSaveDirectoryTooltip}"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="{local:Translate Settings_ImageSaving}">
                            <StackPanel>
                                <CheckBox Content="{local:Translate Settings_SaveMetadata}" IsChecked="{Binding SavePromptWithFile}" ToolTip="{local:Translate Settings_SaveMetadataTooltip}"/>
                                <CheckBox Content="{local:Translate Settings_RemoveBase64OnSave}" IsChecked="{Binding RemoveBase64OnSave}" ToolTip="{local:Translate Settings_RemoveBase64OnSaveTooltip}" Margin="0,5,0,0"/>
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <TextBlock Text="{local:Translate Settings_SaveFormat}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox ItemsSource="{Binding ImageSaveFormatValues}" SelectedItem="{Binding SaveFormat}" Width="100"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <StackPanel.Style><Style TargetType="StackPanel"><Setter Property="Visibility" Value="Collapsed"/><Style.Triggers><DataTrigger Binding="{Binding SaveFormat}" Value="Png"><Setter Property="Visibility" Value="Visible"/></DataTrigger></Style.Triggers></Style></StackPanel.Style>
                                    <TextBlock Text="{local:Translate Settings_PngCompression}" VerticalAlignment="Center" Margin="0,0,10,0" ToolTip="{local:Translate Settings_PngCompressionTooltip}"/>
                                    <xctk:IntegerUpDown Value="{Binding PngCompressionLevel}" Minimum="0" Maximum="9" Width="60"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <StackPanel.Style><Style TargetType="StackPanel"><Setter Property="Visibility" Value="Collapsed"/><Style.Triggers><DataTrigger Binding="{Binding SaveFormat}" Value="Webp"><Setter Property="Visibility" Value="Visible"/></DataTrigger></Style.Triggers></Style></StackPanel.Style>
                                    <TextBlock Text="{local:Translate Settings_WebpQuality}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <xctk:IntegerUpDown Value="{Binding WebpQuality}" Minimum="1" Maximum="100" Width="60"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <StackPanel.Style><Style TargetType="StackPanel"><Setter Property="Visibility" Value="Collapsed"/><Style.Triggers><DataTrigger Binding="{Binding SaveFormat}" Value="Jpg"><Setter Property="Visibility" Value="Visible"/></DataTrigger></Style.Triggers></Style></StackPanel.Style>
                                    <TextBlock Text="{local:Translate Settings_JpgQuality}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <xctk:IntegerUpDown Value="{Binding JpgQuality}" Minimum="1" Maximum="100" Width="60"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="{local:Translate Settings_Queue}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{local:Translate Settings_MaxQueueSize}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <xctk:IntegerUpDown Value="{Binding MaxQueueSize}" Minimum="1" Maximum="10000" Width="80"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="{local:Translate Settings_Interface}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="{local:Translate Settings_Language}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        
                                    <ComboBox ItemsSource="{Binding SupportedLanguages}" 
                                              SelectedValue="{Binding Language}"
                                              SelectedValuePath="TwoLetterISOLanguageName"
                                              Width="150">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding NativeName, Converter={StaticResource ToTitleCaseConverter}}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>


                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{local:Translate Settings_MaxRecentWorkflows}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <xctk:IntegerUpDown Value="{Binding MaxRecentWorkflows}" Minimum="0" Maximum="50" Width="60"/>
                                </StackPanel>
                                
                                <CheckBox Content="{local:Translate Settings_ConfirmDelete}"
                                          IsChecked="{Binding ShowDeleteConfirmation}" 
                                          Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="{local:Translate Settings_Models}">
                            <StackPanel>
                                <TextBlock Text="{local:Translate Settings_ModelExtensions}" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding ModelExtensions, Converter={StaticResource StringListConverter}, UpdateSourceTrigger=PropertyChanged}"/>
                                
                                <TextBlock Text="{local:Translate Settings_SpecialModelValues}" Margin="0,10,0,5" 
                                           ToolTip="{local:Translate Settings_SpecialModelValuesTooltip}"/>
                                <TextBox Text="{Binding SpecialModelValues, Converter={StaticResource StringListConverter}, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="{local:Translate Settings_SliderDefaults_Header}">
                            <StackPanel>
                                <TextBlock Text="{local:Translate Settings_SliderDefaults_Description1}" Margin="0,0,0,5" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text="{local:Translate Settings_SliderDefaults_Description2}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding SliderDefaults, UpdateSourceTrigger=PropertyChanged}" 
                                         AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" 
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="{local:Translate Settings_Hotkeys}">
                            <Grid Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="150" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Ctrl + Enter" FontWeight="Bold"
                                           Margin="0,2" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{local:Translate Settings_Hotkey_Queue}"
                                           Margin="0,2" />
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="NumPad 6" FontWeight="Bold" Margin="0,2" />
                                <TextBlock Grid.Row="1" Grid.Column="1"
                                           Text="{local:Translate Settings_Hotkey_NextImage}" Margin="0,2" />
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="NumPad 4" FontWeight="Bold" Margin="0,2" />
                                <TextBlock Grid.Row="2" Grid.Column="1"
                                           Text="{local:Translate Settings_Hotkey_PrevImage}" Margin="0,2" />
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="NumPad 5" FontWeight="Bold" Margin="0,2" />
                                <TextBlock Grid.Row="3" Grid.Column="1"
                                           Text="{local:Translate Settings_Hotkey_SaveImage}" Margin="0,2" />
                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Escape" FontWeight="Bold" Margin="0,2" />
                                <TextBlock Grid.Row="4" Grid.Column="1"
                                           Text="{local:Translate Settings_Hotkey_ExitFullscreen}" Margin="0,2" />
                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Ctrl + V" FontWeight="Bold" Margin="0,2" />
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{local:Translate Settings_Hotkey_Paste}"
                                           Margin="0,2" TextWrapping="Wrap" />
                                <TextBlock Grid.Row="6" Grid.Column="0" Text="Q (in editor)" FontWeight="Bold" Margin="0,2"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{local:Translate Settings_Hotkey_ToggleInpaintMode}" Margin="0,2" TextWrapping="Wrap"/>

                                <TextBlock Grid.Row="7" Grid.Column="0" Text="Ctrl + Mouse Wheel (in editor)" FontWeight="Bold" Margin="0,2"/>
                                <TextBlock Grid.Row="7" Grid.Column="1" Text="{local:Translate Settings_Hotkey_ChangeBrushSize}" Margin="0,2" TextWrapping="Wrap"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <Border Grid.Row="1" BorderBrush="{StaticResource TertiaryBackground}" BorderThickness="0,1,0,0" Margin="0,10,0,0" Padding="0,10,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="{local:Translate Settings_SaveAndClose}" Command="{Binding SaveCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" IsDefault="True" MinWidth="120" Margin="0,0,10,0"/>
                <Button Content="{local:Translate Settings_Cancel}" IsCancel="True" MinWidth="80" Background="{StaticResource SecondaryBackground}" BorderBrush="{StaticResource TertiaryBackground}" BorderThickness="1"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>