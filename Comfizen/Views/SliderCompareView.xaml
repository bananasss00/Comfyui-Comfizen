<UserControl x:Class="Comfizen.SliderCompareView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Comfizen"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             Visibility="{Binding IsViewOpen, Converter={StaticResource BooleanToVisibilityConverter}}">
    <UserControl.Resources>
        <local:ClipConverter x:Key="ClipConverter"/>
        
        <Style x:Key="OverlayButton" TargetType="Button">
            <Setter Property="Background" Value="#80000000"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="25">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True"><Setter Property="Background" Value="#A0000000"/></Trigger>
                <Trigger Property="IsEnabled" Value="False"><Setter Property="Opacity" Value="0.3"/></Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <Grid Background="#D8000000">
        <!-- Главный контейнер для изображений -->
        <Grid x:Name="ImageContainer" Margin="60">
            <!-- Левое (нижнее) изображение -->
            <Viewbox>
                <Image Source="{Binding ImageLeft.Image}" Stretch="Uniform"
                       AllowDrop="True" Drop="Image_Drop" DragOver="Image_DragOver" Tag="Left"/>
            </Viewbox>

            <!-- Правое (верхнее) изображение с отсечением -->
            <Viewbox>
                <Image Source="{Binding ImageRight.Image}" Stretch="Uniform"
                       AllowDrop="True" Drop="Image_Drop" DragOver="Image_DragOver" Tag="Right">
                    <Image.Clip>
                        <MultiBinding Converter="{StaticResource ClipConverter}">
                            <Binding Path="SliderPosition" RelativeSource="{RelativeSource AncestorType=local:SliderCompareView, Mode=FindAncestor}"/>
                            <Binding ElementName="ImageContainer" Path="ActualWidth"/>
                        </MultiBinding>
                    </Image.Clip>
                </Image>
            </Viewbox>

            <!-- Слайдер-разделитель -->
            <Slider x:Name="CompareSlider" Minimum="0" Maximum="100" 
                    Value="{Binding SliderPosition, Mode=TwoWay}"
                    Foreground="{StaticResource PrimaryAccentBrush}"
                    Background="Transparent"
                    VerticalAlignment="Stretch">
                <Slider.Template>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Thumb x:Name="Thumb" Width="4" Cursor="SizeWE">
                                <Thumb.Template>
                                    <ControlTemplate TargetType="Thumb">
                                        <Grid>
                                            <Rectangle Fill="{TemplateBinding Foreground}" Width="2"/>
                                            <Rectangle Fill="White" Width="4" Opacity="0.5"/>
                                        </Grid>
                                    </ControlTemplate>
                                </Thumb.Template>
                            </Thumb>
                        </Grid>
                    </ControlTemplate>
                </Slider.Template>
                <Slider.RenderTransform>
                    <TranslateTransform X="{Binding RelativeSource={RelativeSource Self}, Path=ActualWidth, ConverterParameter=-0.5, Converter={x:Static local:MultiplyConverter.Instance}}"/>
                </Slider.RenderTransform>
            </Slider>
        </Grid>
        
        <Border HorizontalAlignment="Left" VerticalAlignment="Top" Margin="20" Background="#A0000000" CornerRadius="5" Padding="8,4">
            <TextBlock Text="{Binding ImageLeft.FileName}" TextTrimming="CharacterEllipsis" MaxWidth="300" Foreground="White" />
        </Border>
        <Border HorizontalAlignment="Right" VerticalAlignment="Top" Margin="20" Background="#A0000000" CornerRadius="5" Padding="8,4">
            <TextBlock Text="{Binding ImageRight.FileName}" TextTrimming="CharacterEllipsis" MaxWidth="300" Foreground="White" />
        </Border>
        
        <Button Content="✕" Style="{StaticResource OverlayButton}" Command="{Binding CloseCommand}"
                HorizontalAlignment="Right" VerticalAlignment="Top" Margin="5" Width="40" Height="40" FontSize="20"
                ToolTip="{local:Translate Fullscreen_Close}"/>
        
        <Border HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="20" Background="#A0000000" CornerRadius="10" Padding="10">
            <StackPanel Orientation="Horizontal">
                <Button Content="{local:Translate SliderCompare_Replace}" Command="{Binding ChangeImageLeftCommand}" Style="{StaticResource OverlayButton}" Width="Auto" Padding="15,10" FontSize="16" Height="Auto"/>
                <Button Content="↔" Command="{Binding SwapImagesCommand}" ToolTip="{local:Translate SliderCompare_Swap}" Margin="20,0" Style="{StaticResource OverlayButton}"/>
                <Button Content="{local:Translate SliderCompare_Replace}" Command="{Binding ChangeImageRightCommand}" Style="{StaticResource OverlayButton}" Width="Auto" Padding="15,10" FontSize="16" Height="Auto"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
